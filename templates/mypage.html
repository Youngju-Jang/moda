<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&display=swap" rel="stylesheet">
    <title>Document</title>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

        * {
            font-family: 'Open Sans', sans-serif;
            color: black;
            font-weight: bold;
        }

        main{
            display: flex;
            flex-direction: row;
        }

        .sidenav {
            height: 100%;
            width: 300px;
            position: fixed;
            z-index: 1;
            top: 0;
            left: 0;
            background-color: white;
            opacity: 1;
            overflow-x: hidden;
            padding-top: 20px;
        }

        .modaimage {
            margin: 50px 8px 10px 74px;

        }

        .sidenav a {
            padding: 40px 8px 10px 5px;
            text-decoration: none;
            font-size: 30px;
            font-weight: 500;
            color: #1da1f2;
            display: block;
            text-align: center;
        }

        .sidenav a:hover {
            color: maroon;
        }

        .main {
            margin-left: 160px; /* Same as the width of the sidenav */
            font-size: 28px; /* Increased text to enable scrolling */
            padding: 0px 10px;
        }

        @media screen and (max-height: 450px) {
            .sidenav {
                padding-top: 15px;
            }

            .sidenav a {
                font-size: 18px;
            }
        }

        #profile_img {
            width: 150px;
            height: 150px;
            border-radius: 100%;
            border: 1px solid black;
            background-position: center;
            background-size: cover;
        }

        .main {
            width: 300px;
            margin: 30px auto 0px auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .active {
            content: url('../static/img/full-heart.png');
        }

        #profile {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-bottom: 30px;
        }

        button.form-control:hover {
            background: #1A7BFF;
            color: white;
        }

        #profile > form {
            margin-top: 20px;
        }

        #diary-list {
        }

        .card-body {
            border: 1px solid black;
            margin-bottom: 10px;
            width: 280px;
            display: grid;
            grid-template-rows: 30px 150px 30px;
            background: white;
            gap: 5px;
            padding: 10px;
            align-items: center;

        }

        .card-body > div {
            grid-row-start: 1;
        }

        .card-body > textarea {
            grid-row-start: 2;
            height: 100%;
            resize: none;
        }

        .card-body > textarea::-webkit-scrollbar {
            display: none;
        }

        .card-body > span {
            grid-row-start: 3;
        }

        .card-body > span> img:hover {
            cursor: pointer;
        }

        .card-body_span {
            font-size: 10px;
        }

        .card-body button {
            font-size: 6px;
            padding: 5px;
            line-height: 5px;
        }

        textarea {
            font-size: 20px;

        }

        .card-body > div:first-child {
            display: flex;
            justify-content: space-between;
        }
        .card-body > span:last-child {
            display: flex;
            justify-content: flex-start;
        }
        .card-body > span:last-child > img {
            margin-right: 5px;
        }

        .goods-wrap{
            height: 60%;
            width: 300px;
            position: fixed;
            z-index: 1;
            top: 20%;
            right: 20px;
            background-color: antiquewhite;
            opacity: 1;
            overflow-x: hidden;
            padding-top: 20px;
        }

        .goodBox > img {
            width: 50px;
            height: 50px;
            border-radius: 100%;
            border: 1px solid black;
            background-position: center;
            background-size: cover;
        }
    </style>
    <script>

        $(document).ready(function () {
            // 로딩시 db 이미지, 아이디 불러오기
            let oldUrl = $('#oldUrl').val();
            if (oldUrl == '') {
                $('#profile_img').attr('src', 'https://i.imgur.com/ngFHyCw.png')
            } else {
                $('#profile_img').attr('src', oldUrl);
            }
            show_diary();
        });

        function heartToggle(e, num) {
            // $(document).on("click", ".heart", function () {
            $(e).toggleClass("active");
            let good_give;
            if ($(e).hasClass("active")) {
                good_give = true;
            } else {
                good_give = false;
            }

            $.ajax({
                type: "PATCH",
                url: "/mypage/good",
                data: {
                    user_give: "장영주", // 세션아이디로 수정필요
                    num_give: num,
                    good_give: good_give
                },
                success: function (response) {
                    show_diary()
                }
            })
            // });
        }

        function profile_change() {
            let url_give = $('#profile_url').val()
            $.ajax({
                type: "PATCH",
                url: "/mypage",
                data: {url_give: url_give},
                success: function (response) {
                    if (url_give == '') {
                        $('#profile_img').attr('src', 'https://i.imgur.com/ngFHyCw.png')
                    } else {
                        $('#profile_img').attr('src', url_give)
                    }
                    $('#profile_url').val('')
                }
            })
        }

        function save_comment() {
            $.ajax({
                type: "POST",
                url: "/temp_comment",
                data: {
                    comment_give: $('#comment').val()
                },
                success: function (response) {
                }
            })
        }

        function temp_usermake() {
            $.ajax({
                type: "POST",
                url: "/mypage",
                data: {
                    id_give: $('#id').val(),
                    pw_give: $('#pw').val(),
                    url_give: $('#profile_url').val()
                },
                success: function (response) {
                }
            })
        }

        function show_diary() {
            $('#diary-list').empty()
            $.ajax({
                type: "GET",
                url: "/temp_diary",
                data: {},
                success: function (response) {
                    let rows = response['diary_list']
                    for (let i = 0; i < rows.length; i++) {
                        let user = rows[i]['user']
                        let text = rows[i]['text']
                        let goods = rows[i]['good']
                        let num = rows[i]['write_num']
                        let active = ''
                        if (goods.find(e => e == user)) {
                            active = 'active'
                        }
                        ;
                        let temp_html = `<div class="card-body">
                                            <div>
                                                <span class="card-body_span">${user}</span>
                                                <button type="button" class="btn btn-secondary btn-sm" onclick="check_delete_diary(${num})">X</button>
                                            </div>
                                            <textarea disabled>${text}</textarea>
                                            <span>
                                                <img class="heart ${active}" onclick="heartToggle(this, ${num})" src='../static/img/heart.png' style="width:15px;">
                                                <span class="card-body_span">${goods.length}</span>
                                            </span>
                                        </div>`

                        $('#diary-list').append(temp_html)
                    }
                }
            });
        }

        function save_bucket() {
            let diary = $('#diary').val()

            $.ajax({
                type: "POST",
                url: "/temp_makeDiray",
                data: {diary_give: diary},
                success: function (response) {
                    window.location.reload()
                }
            });
        }

        function check_delete_diary(num) {
            if (!confirm("일기를 지우시겠습니까?")) {
                return
            } else {
                delete_diary(num);
            }
        }

        function delete_diary(num) {
            $.ajax({
                type: "DELETE",
                url: "/mypage",
                data: {num_give: num},
                success: function (response) {
                    alert(response['msg'])
                    window.location.reload()
                }
            });
        }

        // 좋아요
        function good_update(num) {

        }

    </script>
</head>
<body>
<nav></nav>
<main>
    <nav class="sidenav">
        <img class="modaimage" src="https://i.imgur.com/ngFHyCw.png" width="150" height="150">
        <a href="#home">H o m e</a>
        <a href="#list">L i s t</a>
        <a href="/mypage">M y p a g e</a>
    </nav>
    <div class="main">
        <!--사진수정-->
        <div id="profile">
            <img id="profile_img">
            <div id="userName">{{ user.id }}</div>
            <form id="profile_form" enctype="multipart/form-data" onsubmit="return false">
                <div class="row">
                    <input type="hidden" id="id" value={{ user.id }} disabled>
                    <input type="hidden" id="oldUrl" value={{ user.url }}>
                    <!--                <input type="text" id="pw">-->
                    <!--                <button type="button" onclick="temp_usermake()">추가</button>-->
                    <div class="col-md-8">
                        <input type="text" class="form-control" id="profile_url" name="profile_url"
                               placeholder="새 프로필 url">
                    </div>
                    <div class="col-md-4">
                        <button type="button" class="form-control" onclick="profile_change()">변경</button>
                    </div>
                </div>
            </form>
        </div>

    <!--    임시 코멘트 생성칸-->
                <div class="mybox">
                    <div class="mybucket">
                        <input id="comment" class="form-control" type="text" placeholder="오늘의 일기">
                        <button onclick="save_comment()" type="button" class="btn btn-outline-primary">댓글달기</button>
                    </div>
                </div>
        <div class="mybox" id="diary-list"></div>
    </div>
    <div class="goods-wrap">
        <!--   좋아요 리스트   -->
        <div class="goodBox">
            <img src='https://i.imgur.com/ngFHyCw.png'>
            <span>개똥이</span>

        </div>
    </div>
</main>
</body>
</html>

